<!DOCTYPE html>
<html ng-app='dashboard'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Recovery Dashboard</title>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" /><link href="stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="stylesheets/all.css" rel="stylesheet" type="text/css" />
  </head>
  <body class='index'>
    <div class='sidebar ng-cloak' ng-class='{active: show}' ng-controller='SidebarCtrl'>
      <div class='pull' ng-click='toggleSidebar()' ng-hide='show'></div>
      <div id='sidebar' ng-show='show'>
        <div class='close' ng-click='toggleSidebar()'></div>
        <div class='content'>
          <h1>Recovery Dashboard: Nepal Earthquake</h1>
          <p>Following the Mw 7.8 earthquake in Nepal, the World Bank Nepal response team has been collating and curating spatial data useful for damage assessments and recovery planning generated by the International community. Below is a summary of the datasets that are in the public domain, with a brief mention of their usefulness and limitations. Baseline spatial datasets available from KLL and OpenCities are described elsewhere.</p>
          <a target="_blank" href="http://gfdrr.org"><img src="images/logo.png" />
          </a>
          <a target="_blank" href="http://worldbank.org"><img src="images/worldbank.png" />
          </a>
        </div>
      </div>
    </div>
    <div id='recovery-dashboard' ng-controller='RecoveryDashboardCtrl'>
      <openlayers class='dashboard-map' custom-layers='true' ol-center='nepal' ol-defaults='defaults'>
        <ol-layer ng-repeat='layer in layers|filter:{active:true}' ol-layer-properties='layer'></ol-layer>
      </openlayers>
      <div class='ng-cloak' id='popup'>
        <info-window class='poverty' header='{{properties.OBJECTID}}' show-property='name' show-value='poverty'>
          <p ng-show='properties.avg_FGT0_1'>Avg Poor: {{properties.avg_FGT0_1 * 100 | number: 0}} %</p>
          <p ng-show='properties.nIndividua'>People: {{properties.nIndividua}}</p>
        </info-window>
        <info-window class='nasa' header='{{properties.Name}}' show-property='name' show-value='nasa'></info-window>
        <info-window class='buildings' header='{{properties.DISTRICT}}' show-property='name' show-value='db-admin'>
          <p>Overall Damaged Buildings: {{properties.BUILDING_C}}</p>
          <p>Destroyed Buildings: {{properties.DESTROYED_}}</p>
          <p>Moderate Damaged Buildings: {{properties.MODERATE_D}}</p>
          <p>Minor Damaged Buildings: {{properties.MINOR_DAMA}}</p>
        </info-window>
        <info-window class='media' header='{{properties.District}}' show-property='name' show-value='media'>
          <p ng-show='properties.Date'>Date: {{properties.Date}}</p>
          <p ng-show='properties.Injured'>Injured: {{properties.Injured}}</p>
          <p ng-show='properties.Houses_aff'>Houses Affected: {{properties.Houses_aff}}</p>
          <p ng-show='properties.Killed'>Killed: {{properties.Killed}}</p>
          <p ng-show='properties.Needs'>Needs: {{properties.Needs}}</p>
        </info-window>
        <info-window class='valley-landslides' header='{{properties.Name}}' show-property='name' show-value='valley-landslides'>
          <p ng-show='properties.date'>Date: {{properties.date}}</p>
          <p ng-show='properties.Size'>Size: {{properties.Size}}</p>
          <p ng-show='properties.Sensor'>Sensor: {{properties.Sensor}}</p>
          <p ng-show='properties.Location'>Location: {{properties.Location}}</p>
          <p ng-show='properties.FailType'>Fail Type: {{properties.FailType}}</p>
        </info-window>
        <info-window class='landslides-bgs' header='{{properties.Name}}' show-property='name' show-value='landslides-bgs'>
          <p ng-show='properties.Date'>Date: {{properties.Date}}</p>
          <p ng-show='properties.Size'>Size: {{properties.Size}}</p>
          <p ng-show='properties.Source'>Source: {{properties.Source}}</p>
        </info-window>
        <info-window class='landslides' header='{{properties.org}}' show-property='name' show-value='landslides'>
          <p ng-show='properties.Shape_Area'>Area: {{properties.Shape_Area}}</p>
        </info-window>
        <info-window class='osm' header='{{properties.NAME}}' show-property='sourceType' show-value='OSM'>
          <p ng-show='properties.OSM_ID'>OSM_ID: {{properties.OSM_ID}}</p>
        </info-window>
      </div>
      <div class='ng-cloak minify' id='layers' ng-class='{ minify: minify }'>
        <div class='header' ng-mouseout='minify=true' ng-mouseover='minify=false'>
          <ul class='group-header'>
            <li class='group' ng-class='{active: group.active}' ng-click='showGroup()' ng-model='group' ng-repeat='group in layerGroups'>
              <i class='fa fa-{{group.iconClass}}'></i>
              <div class='tooltip'>
                {{group.name}}
              </div>
            </li>
          </ul>
        </div>
        <div class='wrapper'>
          <div id='groups' ng-mouseout='minify=true' ng-mouseover='minify=false'>
            <div class='groups' ng-class='{active: group.active}' ng-repeat='group in layerGroups' ng-show='group.active'>
              <h4>{{group.name}}</h4>
              <div class='layer' ng-model='layer' ng-repeat='layer in group.layers'>
                <div class='layer-check' ng-click='toggleDisplayed()'>
                  <input ng-change='toggleVisibility()' ng-model='layer.displayed' type='checkbox'>
                    <label></label>
                  </input>
                </div>
                <div class='name' ng-click='toggleDisplayed()' ng-model='visibleLayers'>{{layer.metadata.name}}</div>
                <div class='info' ng-click='toggleMetadata()' ng-model='layer.metadata.show'>i</div>
                <div class='sub-styles' ng-show='layer.styleOptions'>
                  <div class='subcheck' ng-model='styleOptions' ng-repeat='styleOptions in layer.styleOptions'>
                    <input name='layerSubStyle' ng-change='changeStyle()' ng-model='layer.selectedStyle' ng-value='styleOptions.styleParam' type='radio'>
                    <p>{{styleOptions.styleName}}</p>
                  </div>
                </div>
              </div>
              <div class='layer' ng-model='combinedLayer' ng-repeat='combinedLayer in group.combinedLayers'>
                <div class='layer-check' ng-click='toggleCombinedDisplayed()'>
                  <input ng-change='toggleCombinedVisibility()' ng-model='combinedLayer.displayed' type='checkbox'>
                    <label></label>
                  </input>
                </div>
                <div class='name' ng-click='toggleCombinedDisplayed()' ng-model='visibleLayers'>{{combinedLayer.name}}</div>
                <div class='info' ng-click='toggleMetadata()' ng-model='combinedLayer.metadata.show'>i</div>
              </div>
            </div>
          </div>
          <div class='active-layers' ng-mouseout='minify=minify' ng-mouseover='minify=minify'>
            <h5>Data currently displayed</h5>
            <div class='active-groups' ng-repeat='group in layerGroups'>
              <div class='layer' ng-repeat='layer in group.layers' ng-show='layer.displayed'>
                <div class='layer-check' ng-click='toggleDisplayed()'>
                  <input ng-change='toggleVisibility()' ng-model='layer.displayed' type='checkbox'>
                    <label></label>
                  </input>
                </div>
                <div class='name' ng-click='toggleDisplayed()' ng-model='visibleLayers'>{{layer.metadata.name}}</div>
              </div>
              <div class='layer' ng-repeat='combinedLayer in group.combinedLayers' ng-show='combinedLayer.displayed'>
                <div class='layer-check' ng-click='toggleCombinedDisplayed()'>
                  <input ng-change='toggleVisibility()' ng-model='combinedLayer.displayed' type='checkbox'>
                    <label></label>
                  </input>
                </div>
                <div class='name' ng-click='toggleCombinedDisplayed()' ng-model='visibleLayers'>{{combinedLayer.metadata.name}}</div>
              </div>
            </div>
            <p>Click on a layer to hide it</p>
          </div>
        </div>
      </div>
      <div id='metadata-info' ng-model='metadata' ng-show='metadata.show'>
        <div class='metadata'>
          <div class='close' ng-click='hideMetadata()'>
            x
          </div>
          <h2 class='name'>{{metadata.name}}</h2>
          <div class='content'>
            <p class='source'>Source: {{metadata.source}}</p>
            <p>{{metadata.text}}</p>
          </div>
        </div>
      </div>
    </div>
    <script src="javascripts/all.js" type="text/javascript"></script>
  </body>
</html>
